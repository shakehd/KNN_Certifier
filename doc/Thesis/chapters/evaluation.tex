%!TEX root = ../dissertation.tex

\chapter{Experimental Evaluation}
\label{chp:experimental-evaluation}


\noindent
We implemented the certifier entirely in Python adopting the optimizations described in \autoref{subsec:certifier-optimizations} and the source code is publicly available in author GitHub repository \cite{github}. Our experimental evaluation was run on Arch Linux in WSL2 on Windows 11 machine with Intel Core i7-1260P 2.10 GHz CPU with 12 physical core and 32 GB of RAM.

This chapter will present the findings of our experimental evaluations of \emph{robustness}, \emph{stability}, and \emph{individual fairness} of \acs{$k$-NN} on different dataset. We compared the results with the tool kNAVe \cite{Nicolo-knn}.

\section{Datasets}
\label{sec:datasets}

For our experiments, we considered $7$ standard datasets used in the most recent stream of works studying the robustness of \acsp{$k$-NN} \cite{WangJC18, Wang19, YangRWC20, SitawarinW19, SitawarinW20, SitawarinKSW21}, on which we also carried out stability tests, and $4$ datasets used for fairness verification of deep neural networks \cite{mehrabi2021survey}.

\noindent
The datasets used to certify robustness and stability properties of \acsp{$k$-NN} are the following:
\begin{itemize}
	\item \textbf{Australian}: dataset concerning credit card applications, consisting of categorical and numerical features. All attribute names and values have been changed to meaningless symbols to protect confidentiality of the data.
	\item \textbf{BreastCancer}: classic and very easy binary classification dataset for diagnostic purpose, where the classification is whether the cancer is benign or malignant.
	\item \textbf{Diabetes}: dataset taken from the National Institute of Diabetes and Digestive and Kidney Diseases. The objective is to predict, based on diagnostic measurements, whether a patient has diabetes.
	\item \textbf{Fourclass}: non-linear separable dataset consisting of $862$ two-dimension data points.
	\item \textbf{Letter}: letter recognition dataset, where the objective is to identify each of a large number of black-and-white rectangular pixel displays as one of the $26$ capital letters in the English alphabet.
	\item \textbf{Pendigits}: digit database created by collecting 250 samples from 44 writers. The samples written by 30 writers are used for training and the digits written by the other 14 are used for testing.
	\item \textbf{Satimage}: database consisting of the multi-spectral values of pixels in $3 \times 3$ neighbourhoods in a satellite image, and the classification associated with the central pixel in each neighbourhood. The aim is to predict this classification, given the multi-spectral values.
\end{itemize}

\noindent
The following dataset were for individual fairness verification:
\begin{itemize}
	\item \textbf{Adult:} dataset extracted from the 1994 US Census database. Every sample assigns a yearly income (below or above $50$K US\$) to an individual based on personal attributes such as gender, race, and occupation.
	\item \textbf{Compas:} dataset containing data collected on the use of the COMPAS risk assessment tool in Broward County, FL. Each sample predicts the risk of recidivism for individuals based on personal attributes and criminal history.
	\item \textbf{Crime}: dataset containing socio-economic, law enforcement, and crime data for communities within the US. Each sample indicates whether a community is above or below the median number of violent crimes per population.
	\item \textbf{German:} dataset containing individuals with either a good or bad credit score.
\end{itemize}

\noindent
The main characteristics of these datasets, as well as their accuracy, are summarized in \autoref{tab:datasets-datail} and  \autoref{tab:datasets-accuracy}, respectively.
\vspace{6pt}

\begin{table}[H]
	\centering
	\begin{tabular}{|l|g|g|g|g|g|}
		\hline
		\rowcolor{white}
		\textbf{Name} & \#training & \#test & \#features & \#features (one-hot) & \#classes \\
		\hline\hline
		\rowcolor{white}
		Australian    &   483 &  207  &  14 &  39 &  2 \\
		BreastCancer  &   479 &  204  &  10 &  10 &  2 \\
		\rowcolor{white}
		Diabetes      &   556 &  230  &   8 &   8 &  2 \\
		Fourclass     &   604 &  258  &   2 &   2 &  2 \\
		\rowcolor{white}
		Letter        & 15000 & 5000  &  16 &  16 & 26 \\
		Pendigits     &  7494 & 3498  &  16 &  16 & 10 \\
		\rowcolor{white}
		Satimage      &  4435 & 2000  &  36 &  36 &  6 \\
		\hline\hline
		Adult         & 30162 & 15060 &  14 & 103 & 2 \\
		\rowcolor{white}
		Compas        &  4222 & 1056  &  10 & 370 & 2 \\
		Crime         &  1595 &  399  & 102 & 147 & 2 \\
		\rowcolor{white}
		German        &   800 &  200  &  20 &  56 & 2 \\
		\hline
	\end{tabular}
	\captionsetup{justification=centering}
	\caption[Datasets used in experimental evaluations]{Datasets used in experimental evaluations.}
	\label{tab:datasets-datail}
\end{table}

\begin{table}[H]
	\centering
	\begin{tabular}{|l|g|g|g|g|}
		\hline
		\rowcolor{white}
		& \multicolumn{4}{c|}{Accuracy (\%)}  \\
		\hline
		\rowcolor{white}
		\textbf{Name} & $k=1$& $k=3$ & $k=5$ & $k=7$ \\
		\hline\hline
		\rowcolor{white}
		Australian    & 77.8 & 80.2 & 82.6 & 82.6 \\
		BreastCancer  & 92.6 & 94.6 & 93.6 & 93.6 \\
		\rowcolor{white}
		Diabetes      & 70.9 & 72.2 & 70.0 & 71.3 \\
		Fourclass     & 100 & 100 & 100 & 100 \\
		\rowcolor{white}
		Letter        & 95.7 & 94.6 & 94.2 & 94.3 \\
		Pendigits     & 97.7 & 97.8 & 97.5 & 97.5 \\
		\rowcolor{white}
		Satimage      & 88.8 & 90.3 & 89.5 & 90.1\\
		\hline\hline
		Adult         & 78.4 & 81.1 & 81.8 & 82.3 \\
		\rowcolor{white}
		Compas        & 58.4 & 59.1 & 60.2 & 61.1 \\
		Crime         & 77.7 & 79.7 & 80.7 & 81.2 \\
		\rowcolor{white}
		German        & 73.0 & 71.5 & 74.5 & 77.0 \\
		\hline
	\end{tabular}
	\captionsetup{justification=centering}
	\caption[Accuracy of each dataset for $k \in \{1,3,5,7\}$]{Accuracy of each dataset for $k \in \{1,3,5,7\}$.}
	\label{tab:datasets-accuracy}
\end{table}


\section{Perturbations}
\label{sec:perturbations}

For our robustness and stability experiments we considered the $\ell_2$-norm perturbation discussed in \autoref{subsec:adv-examples} with a magnitude $\epsilon$ ranging in $[0.001, 0.05]$, i.e., numerical features can be altered from $\pm 0.1\%$ to $\pm 5\%$. Individual fairness for Adult, Compas, Crime and German datasets has been evaluated for the \textsc{Noise-Cat} similarity relation defined in \autoref{subsec:fairness}, where we applied a $\ell_2$-norm \textsc{Noise} perturbation to numerical features, also in this case with $\epsilon$ ranging in $[0, 0.05]$, and a \textsc{Cat} perturbation for the following categorical sensible features:
\begin{itemize}
	\item For Adult and German: \emph{gender}, having 2 categories;
	\item for Compas: \emph{race}, having 2 categories;
	\item for Crime: \emph{state}, having 46 categories.
\end{itemize}


\section{Preprocessing}
\label{sec:results}

We preprocessed each dataset, in accordance with Ruoss et al. \cite{ruoss2020learning}, as follows: (i) rows and columns with missing values are dropped; (ii)when needed, datasets are split into training ($\approx 70$-$80\%$) and test ($\approx 20$-$30\%$) sets. (Letter, Pendigits and Satimage are the only datasets having an independent test set) (iii) categorical features are one-hot encoded; (iv) numerical features are scaled to $[0,1]$ range.

\noindent
Thus, if the space $X$ consists of $n$-dimensional real vectors scaled to [0, 1], an $\ell_2$-norm perturbation having magnitude $\epsilon \geq 0$ on a feature vector $\vec{x} \in X$ defines the adversarial region:
\begin{equation*}
	P^\epsilon_\infty(\vec{x}) \triangleq \{\vec{w} \in \mathbb{R}^n  ~|~ \forall i \in [1,\ldots,n].\: \vec{w}_i \in [\vec{x}_i - \epsilon, \vec{x}_i + \epsilon] \}
\end{equation*}


\section{Results}
\label{subsec:stab-rob-results}

We performed our experiments $k \in \{1, 3, 5, 7\}$, and, following the standard practice for the \acs{$k$-NN} algorithm, we avoided even values of $k$ as they are more likely to introduce tie votes in the classification. To make the certification process more efficient:
\begin{itemize}
	\item We generated the BSP tree of test dataset with partition size 100 only once and used it for the test samples;
	\item We compute the \acs{APP-G} of the input only once since it is the same for each value of $k$;
	\item We processed the test samples concurrently using 12 concurrent process (i.e., the number of the cpu physical core)
\end{itemize}

This allowed us to save a considerable amount of time for the certification with multiple values of $k$.

\autoref{tab:avg-time} shows the average certification time per input sample and perturbation magnitude $\epsilon$. These runtimes are computed taking the average time for executing the optimized certifier for all $k \in \{1,3,5,7\}$ on a given sample $x$ and for a given perturbation magnitude $\epsilon$. For all datasets we run our certifier with magnitude $\epsilon \in \{0.001, 0.002,\allowbreak 0.005, 0.01, 0.02, 0.03, 0.04, 0.05\}$. However, for \textit{Letter, SatImage, Adult} and \textit{Crime}, we only used magnitudes $\epsilon \in{0.001,0.002,0.005,0.01}$ and \textit{Diabetes, Pendigits} we used $\epsilon \in{0.001,0.002,0.005,0.01, 0.02, 0.030.04}$  due to high runtimes at higher perturbations. This is because the certifier does not scale well for these datasets, as for some labels $l$ it asserts the existence for a path with $k=7$ sample where $l$ is dominant when in actuality it doesn't because the solution found with liner programming is not actually an adversarially valid path. Consequently, the certifier spends a lot of time to find a path with $k=7$ samples even when such a path does not exist.

\begin{table}[H]
	\centering
 \begin{tabular}{|l|g|g|g|}
		\hline
		\rowcolor{white}
		\textbf{Name} & N. of magnitude $\epsilon$& Avg.\ Time per $\epsilon$ \\
		\hline\hline
		\rowcolor{white}
		Australian   & 8 & 2 s \\
		BreastCancer & 8 & 2.75 s\\
		\rowcolor{white}
		Diabetes      & 7 & 3 m  \\
		Fourclass     & 8 & 1.2 s \\
		\rowcolor{white}
		Letter        & 4 & 2 m \\
		Pendigits     & 8 & 15 m \\
		\rowcolor{white}
		Satimage      & 4 & 2 m \\
		\hline\hline
		Adult         & 8 &  60 m \\
		\rowcolor{white}
		Compass       & 8 & 2.5 m \\
		Crime         & 4 & 8 m \\
		\rowcolor{white}
		German        & 8 & 5 s \\
		\hline
	\end{tabular}
	\captionsetup{justification=centering}
	\caption[Average certification time]{Average certification time.}
	\label{tab:avg-time}
\end{table}

The results for stability, robustness, and individual fairness are shown in the following two subsections.

\subsection{Stability and Robustness Certification}

The Tables below report the percentages of samples in the test dataset $T$ certified to be stable and robust, namely, $\textsc{Stability}(C, \mathcal{T})$ and $\textsc{Robustness}(C, \mathcal{T})$ metrics defined in \eqref{eq:stab-rob}. These results show that for majority of dataset, the certifier was able to certify the stability of more than $90\%$ of test samples for $\epsilon \leq 0.02$ which means the \acs{$k$-NN} is a fairly robust classifier against adversarial attacks. As expected, higher perturbation magnitude $\epsilon$ values leads to a decrease in the stability and robustness percentages since stronger perturbations result in adversarial region that most likely intersect with the decision boundaries. In particular, we observe that \textit{Diabetes} exhibits the worst stability scores: while it is not possible to give a sure interpretation, the low accuracy ($\simeq  70\%$) hints that diagnosis of diabetes is a hard task for which kNN does not perform well. Consistent with theoretical predictions, for a given value of $\epsilon$, higher values of $k$ leads to more stable classifications. This trend is observed for all dataset except for \textit{Letter} probably due to the fact the decision boundaries are not well separated due to the data distribution making the \acs{$k$-NN} particularly susceptible to adversarial attacks.

The tables also present a comparison with the tool kNAVe \cite{Nicolo-knn}. Our certifier outperforms kNAVe on all datasets, as expected, since kNAVe is not exact, especially at higher $\epsilon$ values, where ties in abstract distance become more prevalent.

\vspace{10pt}

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{Australian Certified Stability (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
    0.001 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 \\
    0.002 & 99.0 & 99.0 & 99.5 & 99.5 & 100.0 & 100.0 & 100.0 & 100.0 \\
    \rowcolor{white}
    0.005 & 97.1 & 99.0 & 98.6 & 99.5 & 97.6 & 100.0 & 99.0 & 100.0 \\
    0.01  & 95.2 & 97.5 & 96.6 & 98.0 & 96.1 & 98.5 & 97.1 & 99.5 \\
    \rowcolor{white}
    0.02  & 92.8 & 96.1 & 91.3 & 97.1 & 91.8 & 96.6 & 97.1 & 98.5 \\
    0.03  & 91.3 & 94.2 & 88.9 & 94.2 & 89.4 & 93.7 & 94.7 & 96.1 \\
    \rowcolor{white}
    0.04  & 88.4 & 93.2 & 85.0 & 92.2 & 87.9 & 93.2 & 88.9 & 95.1 \\
    0.05  & 86.0 & 93.2 & 84.1 & 90.3 & 85.5 & 91.7 & 86.0 & 94.6 \\
    \hline
    \multicolumn{9}{c}{}\\\hline
    \multicolumn{9}{|c|}{\textbf{Australian Certified robustness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
    0.001 & 77.8 & 77.8 & 80.2 & 80.2 & 82.6 & 82.6 & 82.6 & 82.6 \\
    0.002 & 77.8 & 77.8 & 79.7 & 79.7 & 82.6 & 82.6 & 82.6 & 82.6 \\
    \rowcolor{white}
    0.005 & 77.8 & 77.8 & 79.2 & 79.7 & 81.2 & 82.6 & 81.6 & 82.6 \\
    0.01 & 75.4 & 77.2 & 77.8 & 78.7 & 79.7 & 82.1 & 80.7 & 82.1 \\
    \rowcolor{white}
    0.02 & 73.9 & 76.3 & 75.8 & 78.2 & 77.8 & 80.1 & 79.2 & 81.1 \\
    0.03 & 72.9 & 74.3 & 74.4 & 77.8 & 76.8 & 78.7 & 77.8 & 79.7 \\
    \rowcolor{white}
    0.04 & 70.5 & 73.4 & 72.5 & 76.3 & 76.3 & 78.2 & 75.4 & 79.7 \\
    0.05 & 68.6 & 73.4 & 71.5 & 75.3 & 74.4 & 77.8 & 73.9 & 79.7 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 100.0 100.0 100.0 100.0
    0.2 99.0 99.5 100.0 100.0
    0.5 99.0 99.5 100.0 100.0
    1  97.5 98.0 98.5 99.5
    2  96.1 97.1 96.6 98.5
    3  94.2 94.2 93.7 96.1
    4  93.2 92.2 93.2 95.1
    5  93.2 90.3 91.7 94.6
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Australian},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\quad
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 77.8 80.2 82.6 82.6
    0.2 77.8 79.7 82.6 82.6
    0.5 77.8 79.7 82.6 82.6
    1 77.8 79.7 82.6 82.6
    2 76.3 78.2 80.1 81.1
    3 74.3 77.8 78.7 79.7
    4 73.4 76.3 78.2 79.7
    5 73.4 75.3 77.8 79.7
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Australian},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Robustness (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified stability and robustness on the whole Australian test set]{Certified stability and robustness on the whole Australian test set.}
	\label{fig:proved-stab-rob-Australian}
\end{figure}

%%%%%%%%% Breast Cancer %%%%%%%%%

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{BreastCancer Certified Stability (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
    0.001 & 99.5 & 99.5 & 100.0 & 100.0 & 99.0 & 99.0 & 99.5 & 99.5 \\
    0.002 & 98.5 & 99.5 & 100.0 & 100.0 & 99.0 & 99.0 & 99.0 & 99.0 \\
    \rowcolor{white}
    0.005 & 96.6 & 98.0 & 99.5 & 100.0 & 98.0 & 99.0 & 98.5 & 99.0 \\
    0.01  & 96.6 & 96.5 & 99.0 & 99.5 & 96.6 & 98.0 & 97.1 & 98.0 \\
    \rowcolor{white}
    0.02  & 92.2 & 96.5 & 93.1 & 97.0 & 91.7 & 98.0 & 93.1 & 97.5 \\
    0.03  & 86.8 & 94.1 & 88.7 & 94.6 & 87.7 & 94.1 & 82.2 & 96.0 \\
    \rowcolor{white}
    0.04  & 80.4 & 91.6 & 83.3 & 92.1 & 83.3 & 93.1 & 85.3 & 94.1 \\
    0.05  & 75.0 & 88.7 & 77.9 & 90.1 & 81.4 & 91.6 & 83.8 & 90.1 \\
    \hline
    \multicolumn{9}{c}{}\\\hline
    \multicolumn{9}{|c|}{\textbf{BreastCancer Certified robustness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
    0.001 & 92.6 & 92.6 & 94.6 & 94.6 & 93.6 & 93.6 & 93.1 & 93.1 \\
    0.002 & 92.2 & 92.6 & 94.6 & 94.6 & 93.6 & 93.6 & 92.6 & 92.6 \\
    \rowcolor{white}
    0.005 & 91.2 & 92.1 & 94.1 & 94.6 & 93.1 & 93.6 & 92.6 & 92.6 \\
    0.01 & 91.2 & 91.2 & 93.6 & 94.1 & 91.7 & 93.1 & 92.2 & 92.6 \\
    \rowcolor{white}
    0.02 & 88.2 & 91.1 & 89.7 & 92.1 & 88.7 & 93.1 & 89.7 & 92.1 \\
    0.03 & 84.3 & 89.7 & 86.8 & 90.6 & 86.8 & 90.1 & 87.3 & 91.1 \\
    \rowcolor{white}
    0.04 & 78.9 & 88.7 & 82.4 & 89.7 & 82.4 & 89.7 & 84.8 & 90.1 \\
    0.05 & 74.5 & 85.7 & 77.5 & 88.2 & 80.9 & 89.2 & 83.3 & 90.1 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 99.5 100.0 99.0 99.5
    0.2 99.5 100.0 99.0 99.0
    0.5 98.0 100.0 99.0 99.0
    1  96.5 99.5 98.0 98.0
    2  96.5 97.0 98.0 97.5
    3  94.1 94.6 94.1 96.0
    4  91.6 92.1 93.1 94.1
    5  88.7 90.1 91.6 90.1
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries BreastCancer},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\quad
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 92.6 94.6 93.6 93.1
    0.2 92.6 94.6 93.6 92.6
    0.5 92.1 94.6 93.6 92.6
    1 91.2 94.1 93.1 92.6
    2 91.1 92.1 93.1 92.1
    3 89.7 90.6 90.1 91.1
    4 88.7 89.7 89.7 90.1
    5 85.7 88.2 89.2 90.1
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries BreastCancer},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Robustness (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified stability and robustness on the whole BreastCancer test set]{Certified stability and robustness on the whole BreastCancer test set.}
	\label{fig:proved-stab-rob-BreastCancer}
\end{figure}

%%%%%%%%% Diabetes%%%%%%%%%

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{Diabetes Certified Stability (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
		0.001 & 95.2 & 97.8 & 96.1 & 97.3 & 98.7 & 98.6 & 98.7 & 99.1 \\
		0.002 & 89.1 & 94.7 & 91.3 & 93.4 & 94.8 & 97.3 & 94.3 & 96.9 \\
		\rowcolor{white}
		0.005 & 78.7 & 85.6 & 80.4 & 89.1 & 80.0 & 91.3 & 77.4 & 91.7 \\
		0.01 & 62.6 & 77.8 & 59.6 & 80.4 & 56.5 & 81.3 & 54.3 & 80.0 \\
		\rowcolor{white}
		0.02 & 31.3 & 59.1 & 25.7 & 59.1 & 23.9 & 61.3 & 23.0 & 66.0 \\
		0.03 & 13.0 & 40.4 & 9.1 & 44.3 & 7.8 & 47.8 & 6.1 & 51.7 \\
		\rowcolor{white}
		0.04 & 7.8 & 30.4 & 4.3 & 33.4 & 4.8 & 38.2 & 3.0 & 43.4 \\
    \hline
    \multicolumn{9}{c}{}\\\hline
    \multicolumn{9}{|c|}{\textbf{Diabetes Certified robustness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
    0.001 & 69.1 & 70.0 & 71.3 & 71.7 & 69.6 & 69.6 & 71.3 & 71.3 \\
		0.002 & 65.7 & 68.6 & 68.7 & 70.0 & 67.4 & 68.2 & 69.6 & 71.3 \\
		\rowcolor{white}
		0.005 & 60.0 & 63.9 & 62.2 & 67.3 & 61.3 & 67.3 & 59.1 & 67.8 \\
		0.01 & 49.1 & 58.6 & 49.6 & 63.0 & 47.0 & 63.0 & 46.5 & 61.7 \\
		\rowcolor{white}
		0.02 & 25.2 & 45.6 & 23.0 & 47.8 & 22.6 & 50.0 & 21.7 & 54.3 \\
		0.03 & 11.7 & 33.4 & 8.7 & 37.3 & 7.4 & 41.3 & 6.1 & 44.7 \\
		\rowcolor{white}
		0.04 & 7.4 & 27.3 & 4.3 & 29.5 & 4.3 & 33.4 & 3.0 & 38.2 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 97.8 97.3 98.6 99.1
		0.2 94.7 93.4 97.3 96.9
		0.5 85.6 89.1 91.3 91.7
		1 77.8 80.4 81.3 80.0
		2 59.1 59.1 61.3 66.0
		3 40.4 44.3 47.8 51.7
		4 30.4 33.4 38.2 43.4
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Diabetes},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\quad
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 70.0 71.7 69.6 71.3
		0.2 68.6 70.0 68.2 71.3
		0.5 63.9 67.3 67.3 67.8
		1 58.6 63.0 63.0 61.7
		2 45.6 47.8 50.0 54.4
		3 33.4 37.3 41.3 44.7
		4 27.3 29.5 33.4 38.2
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Diabetes},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Robustness (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified stability and robustness on the whole Diabetes test set]{Certified stability and robustness on the whole Diabetes test set.}
	\label{fig:proved-stab-rob-diabetes}
\end{figure}

%%%%%%%%% Fourclass %%%%%%%%%

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{Fourclass Certified Stability (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
		0.001 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 \\
		0.002 & 99.6 & 99.6 & 99.6 & 99.6 & 100.0 & 100.0 & 100.0 & 100.0 \\
		\rowcolor{white}
		0.005 & 99.6 & 99.6 & 99.6 & 99.6 & 99.2 & 99.2 & 98.8 & 99.6 \\
		0.01 & 99.2 & 99.6 & 99.6 & 99.6 & 98.4 & 98.8 & 97.7 & 98.4 \\
		\rowcolor{white}
		0.02 & 93.4 & 96.5 & 91.5 & 97.6 & 86.8 & 97.2 & 85.3 & 96.8 \\
		0.03 & 78.3 & 89.1 & 75.6 & 86.8 & 75.6 & 89.1 & 72.9 & 88.3 \\
		\rowcolor{white}
		0.04 & 62.0 & 79.0 & 60.5 & 79.4 & 59.3 & 79.8 & 55.8 & 80.2 \\
		0.05 & 45.0 & 71.3 & 42.6 & 70.9 & 40.3 & 70.5 & 37.6 & 72.0 \\
    \hline
    \multicolumn{9}{c}{}\\\hline
    \multicolumn{9}{|c|}{\textbf{Fourclass Certified robustness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
    0.001 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 & 100.0 \\
		0.002 & 99.6 & 99.6 & 99.6 & 99.6 & 100.0 & 100.0 & 100.0 & 100.0 \\
		\rowcolor{white}
		0.005 & 99.6 & 99.6 & 99.6 & 99.6 & 99.2 & 99.2 & 98.8 & 99.6 \\
		0.01 & 99.2 & 99.6 & 99.6 & 99.6 & 98.4 & 98.8 & 97.7 & 98.4 \\
		\rowcolor{white}
		0.02 & 93.4 & 96.5 & 91.5 & 97.6 & 86.8 & 97.2 & 85.3 & 96.8 \\
		0.03 & 78.3 & 89.1 & 75.6 & 86.8 & 75.6 & 89.1 & 72.9 & 88.3 \\
		\rowcolor{white}
		0.04 & 62.0 & 79.0 & 60.5 & 79.4 & 59.3 & 79.8 & 55.8 & 80.2 \\
		0.05 & 45.0 & 71.3 & 42.6 & 70.9 & 40.3 & 70.5 & 37.6 & 72.0 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 100.0 100.0 100.0 100.0
		0.2 99.6 99.6 100.0 100.0
		0.5 99.6 99.6 99.2 99.6
		1 99.6 99.6 98.8 98.4
		2 96.5 97.6 97.2 96.8
		3 89.1 86.8 89.1 88.3
		4 79.0 79.4 79.8 80.2
		5 71.3 70.9 70.5 72.0
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Fourclass},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\quad
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 100.0 100.0 100.0 100.0
		0.2 99.6 99.6 100.0 100.0
		0.5 99.6 99.6 99.2 99.6
		1 99.6 99.6 98.8 98.4
		2 96.5 97.6 97.2 96.8
		3 89.1 86.8 89.1 88.3
		4 79.0 79.4 79.8 80.2
		5 71.3 70.9 70.5 72.0
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Fourclass},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Robustness (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified stability and robustness on the whole Fourclass test set]{Certified stability and robustness on the whole Fourclass test set.}
	\label{fig:proved-stab-rob-fourclass}
\end{figure}


%%%%%%%%% Letter %%%%%%%%%

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{Letter Certified Stability (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
		0.001 & 98.0 & 98.0 & 96.3 & 96.3 & 95.2 & 95.2 & 95.6 & 95.7 \\
		0.002 & 96.7 & 97.8 & 94.4 & 96.0 & 92.7 & 94.7 & 92.1 & 94.7 \\
		\rowcolor{white}
		0.005 & 91.7 & 94.0 & 88.6 & 92.3 & 85.4 & 90.4 & 83.1 & 90.4 \\
		0.01 & 82.7 & 88.7 & 75.1 & 86.4 & 69.5 & 84.4 & 65.2 & 83.4 \\
    \hline
    \multicolumn{9}{c}{}\\\hline
    \multicolumn{9}{|c|}{\textbf{Letter Certified robustness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
    0.001 & 94.7 & 94.7 & 93.6 & 93.6 & 92.9 & 92.9 & 93.0 & 93.0 \\
		0.002 & 93.9 & 94.6 & 92.3 & 93.4 & 91.1 & 92.5 & 90.5 & 92.4 \\
		\rowcolor{white}
		0.005 & 90.4 & 92.2 & 87.8 & 90.9 & 84.8 & 89.3 & 82.7 & 89.3 \\
		0.01 & 82.2 & 87.9 & 75.0 & 85.9 & 69.4 & 83.8 & 65.1 & 82.9 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.01 98.0 96.3 94.8 95.7
		0.02 97.8 96.0 94.7 94.7
		0.05 94.0 92.3 90.4 90.4
		1 88.7 86.4 84.4 83.4
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Letter},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\quad
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.01 94.7 93.6 92.9 93.0
		0.02 94.6 93.4 92.5 92.4
		0.05 92.2 90.9 89.3 89.3
		1 87.9 85.9 83.8 82.9
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Letter},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Robustness (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified stability and robustness on the whole Letter test set]{Certified stability and robustness on the whole Letter test set.}
	\label{fig:proved-stab-rob-letter}
\end{figure}

%%%%%%%%% Pendigits %%%%%%%%%

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{Pendigits Certified Stability (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
		0.001 & 99.6 & 99.6 & 99.5 & 99.6 & 99.4 & 99.4 & 99.6 & 99.7 \\
		0.002 & 99.3 & 99.5 & 99.1 & 99.3 & 99.1 & 99.2 & 99.2 & 99.4 \\
		\rowcolor{white}
		0.005 & 98.3 & 98.9 & 98.1 & 98.7 & 98.1 & 98.7 & 97.8 & 98.9 \\
		0.01 & 96.7 & 97.7 & 96.1 & 97.8 & 95.7 & 97.8 & 95.0 & 97.8 \\
		\rowcolor{white}
		0.02 & 91.4 & 95.2 & 90.5 & 95.2 & 89.5 & 95.2 & 89.1 & 95.1 \\
		0.03 & 82.0 & 91.7 & 82.0 & 92.1 & 81.0 & 92.2 & 80.0 & 92.4 \\
		\rowcolor{white}
		0.04 & 71.3 & 86.5 & 71.5 & 88.9 & 71.0 & 89.2 & 70.2 & 89.3 \\
    \hline
    \multicolumn{9}{c}{}\\\hline
    \multicolumn{9}{|c|}{\textbf{Pendigits Certified robustness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
    0.001 & 97.6 & 97.6 & 97.5 & 97.6 & 97.4 & 97.4 & 97.4 & 97.4 \\
		0.002 & 97.4 & 97.5 & 97.5 & 97.5 & 97.3 & 97.3 & 97.2 & 97.3 \\
		\rowcolor{white}
		0.005 & 96.8 & 97.2 & 96.8 & 97.2 & 96.7 & 97.0 & 96.3 & 97.0 \\
		0.01 & 95.6 & 96.4 & 95.3 & 96.6 & 94.9 & 96.4 & 94.1 & 96.3 \\
		\rowcolor{white}
		0.02 & 90.9 & 94.4 & 90.2 & 94.5 & 89.2 & 94.5 & 88.7 & 94.2 \\
		0.03 & 81.7 & 91.2 & 81.7 & 91.6 & 80.8 & 91.7 & 79.8 & 91.8 \\
		\rowcolor{white}
		0.04 & 71.2 & 86.2 & 71.4 & 88.5 & 71.0 & 88.9 & 70.2 & 89.0 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 99.6 99.6 99.4 99.7
		0.2 99.5 99.3 99.2 99.4
		0.5 98.9 98.7 98.7 98.9
		1 97.7 97.8 97.8 97.8
		2 95.2 95.2 95.2 95.1
		3 91.7 92.1 92.2 92.4
		4 86.5 88.9 89.2 89.3
		5 80.7 83.0 84.2 84.7
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Pendigits},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\quad
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 97.6 97.6 97.4 97.4
		0.2 97.5 97.5 97.3 97.3
		0.5 97.2 97.2 97.0 97.0
		1 96.4 96.6 96.4 96.3
		2 94.4 94.5 94.5 94.2
		3 91.2 91.6 91.7 91.8
		4 86.2 88.5 88.9 89.0
		5 80.7 83.0 84.2 84.7
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Pendigits},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Robustness (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified stability and robustness on the whole Pendigits test set]{Certified stability and robustness on the whole Pendigits test set.}
	\label{fig:proved-stab-rob-pendigits}
\end{figure}


%%%%%%%%% SatImage %%%%%%%%%

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{SatImage Certified Stability (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
		0.001 & 93.8 & 96.0 & 93.8 & 95.7 & 93.7 & 95.9 & 94.3 & 96.3 \\
		0.002 & 88.7 & 92.9 & 88.9 & 93.4 & 88.9 & 93.9 & 88.1 & 94.1 \\
		\rowcolor{white}
		0.005 & 73.7 & 84.4 & 72.9 & 86.0 & 72.4 & 88.0 & 72.4 & 88.7 \\
		0.01 & 56.0 & 71.3 & 54.9 & 74.9 & 54.0 & 77.7 & 54.2 & 79.0 \\
    \hline
    \multicolumn{9}{c}{}\\\hline
    \multicolumn{9}{|c|}{\textbf{SatImage Certified robustness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
    0.001 & 86.1 & 87.0 & 87.4 & 88.5 & 87.0 & 88.2 & 87.5 & 88.6 \\
		0.002 & 83.0 & 85.9 & 84.3 & 87.3 & 84.1 & 87.1 & 83.4 & 87.5 \\
		\rowcolor{white}
		0.005 & 71.7 & 80.1 & 71.7 & 82.4 & 71.0 & 83.8 & 70.8 & 83.9 \\
		0.01 & 55.4 & 69.7 & 54.6 & 73.4 & 53.8 & 75.6 & 53.8 & 76.8 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 96.0 95.7 95.9 96.3
		0.2 92.9 93.4 93.9 94.1
		0.5 84.4 86.0 88.0 88.7
		1 71.3 74.9 77.7 79.0
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries SatImage},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\quad
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0.1 87.0 88.5 88.2 88.6
		0.2 85.9 87.3 87.1 87.5
		0.5 80.1 82.4 83.8 83.9
		1 69.7 73.4 75.6 76.8
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries SatImage},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Robustness (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified stability and robustness on the whole SatImage test set]{Certified stability and robustness on the whole SatImage test set.}
	\label{fig:proved-stab-rob-satimage}
\end{figure}

\subsection{Individual Fairness Certification}
\label{subsec:fairness-results}

Tables below reports the percentages of provable individual fairness for all the test samples ranging in each ground truth test dataset $T$, namely, $\textsc{Fairness}(C, T)$ metric defined in \eqref{eq:fairness}. As for stability and robustness, we performed our experiments with $k \in \{1, 3, 5, 7\}$, thus avoiding even values of $k$ as they are more likely to introduce tie votes in the classification. Our experiments show that \acs{$k$-NN} predications are fair for the \textit{German} and \textit{Adult} on the sensible \textit{gender} category since when $\epsilon = 0$, that is no perturbation on the numerical feature but only on the chosen categorical feature, the percentage of stable samples is already relatively high. On the other hand \textit{Compas} and especially \textit{Crime} are rather unfair on the sensible \textit{race} and \textit{state} category respectively.

%%%%%%%%% Adults %%%%%%%%%

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{Adult Certified Individual Fairness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
		0 &  95.4 & 95.4 & 97.3 & 97.3 &  97.7 & 97.7 & 97.8 & 97.8 \\
		0.001 & 92.3 & 93.8 & 94.6 & 96.1 & 95.3 & 96.6 & 95.3 & 96.7 \\
		\rowcolor{white}
		0.002 & 89.9 & 92.4 & 92.0 & 94.7 & 93.0 & 95.5 & 93.2 & 95.7 \\
		0.005 & 82.4 & 88.5 & 84.7 & 91.5 & 85.9 & 92.7 & 86.5 & 93.2 \\
		\rowcolor{white}
		0.01 & 72.7 & 82.7 & 75.5 & 86.5 & 76.5 & 88.4 & 77.1 & 89.4 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0 95.4 97.3 97.7 97.8
		0.1 93.8 96.1 96.6 96.7
		0.2 92.4 94.7 95.5 95.7
		0.5 88.5 91.5 92.7 93.2
		1 82.7 86.5 88.4 89.4
		2 73.1 78.9 82.0 83.9
		3 66.8 73.1 76.9 79.2
		4 66.8 73.1 76.9 79.2
		5 57.0 66.0 70.2 65.5
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Adult},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Cerrtified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified fairness on the whole Adult test set]{Certified fairness on the whole Adult test set.}
	\label{fig:certified-fairness-adult}
\end{figure}

%%%%%%%%% Compas %%%%%%%%%

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{Compas Certified Individual Fairness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
		0 & 58.3 & 58.3 & 62.7 & 62.6 & 69.1 & 69.1 & 71.1 & 71.1\\
		0.001 & 48.2 & 51.0 & 54.5 & 57.7 & 61.1 & 64.8 & 62.5 & 66.1 \\
		\rowcolor{white}
		0.002 & 45.6 & 49.3 & 50.9 & 55.7 & 56.8 & 62.2 & 57.6 & 64.0 \\
		0.005 & 35.3 & 45.4 & 41.4 & 51.4 & 45.4 & 55.7 & 46.1 & 58.4 \\
		\rowcolor{white}
		0.01 & 25.7 & 35.4 & 30.7 & 42.5 & 32.8 & 47.9 & 36.4 & 51.4 \\
		0.02 & 17.8 & 27.2 & 20.9 & 4.39 & 23.9 & 41.0 & 27.5 & 43.7 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0 58.3 62.7 69.1 71.1
		0.01 51.0 57.7 64.8 66.1
		0.02 49.3 55.7 62.2 64.0
		0.05 45.4 51.4 55.7 58.4
		1 35.4 42.5 47.9 51.4
		2 27.2 4.39 41.0 43.7
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Compas},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified fairness on the whole Compas test set]{Certified fairness on the whole Compas test set.}
	\label{fig:certified-fairness-compas}
\end{figure}

%%%%%%%%% Crime %%%%%%%%%

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{Crime Certified Individual Fairness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
		0 & 7.5 & 7.5 & 13.0 & 13.0 & 15.8 & 15.8 & 18.5 & 18.5 \\
		0.001 & 6.5 & 7.01 & 12.3 & 12.5 & 14.5 & 15.0 & 17.8 & 18.0 \\
		\rowcolor{white}
		0.002 & 6.0 & 6.5 & 11.5 & 11.7 & 13.3 & 14.2 & 16.0 & 17.2 \\
		0.005 & 4.8 & 6.0 & 9.8 & 11.2 & 10.8 & 13.2 & 13.0 & 15.7 \\
		\rowcolor{white}
		0.01 & 4.0 & 5.2 & 5.0 & 10.0 & 7.0 & 11.5 & 7.8 & 13.7 \\
    \hline
  \end{tabular}
\end{table}

%%%%%%%%% German %%%%%%%%%

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0 7.5 13.0 15.8 18.5
		0.1 7.0 12.5 15.0 18.0
		0.2 6.5 11.7 14.2 17.2
		0.5 6.0 11.2 13.2 15.7
		1 5.2 10.0 11.5 13.7
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries Crime},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified fairness on the whole Crime test set]{Certified fairness on the whole Crime test set.}
	\label{fig:certified-fairness-crime}
\end{figure}

\begin{table}[H]
  \centering
  \begin{tabular}{|c||gg|gg|gg|gg|}
    \hline
    \multicolumn{9}{|c|}{\textbf{German Certified Individual Fairness (\%)}}\\ \hline\hline
    \rowcolor{white}
    \multirow{2}{*}{$\epsilon$}&\multicolumn{2}{c|}{$k=1\uparrow$}&\multicolumn{2}{c|}{$k=3\uparrow$}&\multicolumn{2}{c|}{$k=5\uparrow$} &\multicolumn{2}{c|}{$k=7\uparrow$} \\
          & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert & \cellcolor{white}kNAVe & \cellcolor{white}OptCert \\
    \hline\hline
    \rowcolor{white}
		0 &  85.0 & 85.0 & 83.0 & 83.0 & 83.5 & 83.5 & 82.5 & 82.5 \\
		0.001 & 85.0 & 85.0 & 83.0 & 83.0 & 83.0 & 83.0 & 82.0 & 82.5 \\
		\rowcolor{white}
		0.002 & 85.0 & 85.0 & 82.5 & 83.0 & 82.5 & 82.5 & 82.0 & 82.0 \\
		0.005 & 85.0 & 85.0 & 81.5 & 83.0 & 82.5 & 82.5 & 81.5 & 81.5 \\
		\rowcolor{white}
		0.01 & 83.0 & 84.0 & 78.0 & 80.5 & 81.0 & 81.5 & 81.5 & 81.5 \\
		0.02 & 80.0 & 81.5 & 75.5 & 79.0 & 78.0 & 80.5 & 78.5 & 81.5 \\
		\rowcolor{white}
		0.03 & 76.0 & 80.0 & 72.5 & 77.0 & 75.0 & 79.0 & 73.5 & 79.5 \\
		0.04 & 73.0 & 78.5 & 71.5 & 76.0 & 72.5 & 76.5 & 71.0 & 78.0 \\
		\rowcolor{white}
		0.05 & 72.0 & 77.0 & 68.5 & 76.0 & 69.0 & 75.5 & 69.5 & 77.0 \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[H]
	\centering
	\pgfplotstableread{
		epsilon k1 k3 k5 k7
		0 85.0 83.0 83.5  82.5
		0.1 85.0 83.0 83.0 82.5
		0.2 85.0 83.0 82.5 82.0
		0.5 85.0 83.0 82.5 81.5
		1 84.0 80.5 81.5 81.5
		2 81.5 79.0 80.5 81.5
		3 80.0 77.0 79.0 79.5
		4 78.5 76.0 76.5 78.0
		5 77.0 76.0 75.5 77.0
	}\loadedtable
	\pgfplotsset{grid style={dashed}}
	\begin{tikzpicture}
		\begin{axis}[
			title = {\small \bfseries German},
			xlabel = {\footnotesize Perturbation (\%)},
			ylabel = {\footnotesize Certified Stability (\%)},
			width = 7cm,
			height = 7cm,
			grid = both,
			major grid style = {lightgray},
			legend style = {nodes={scale=0.7, transform shape}},
			legend pos = north east,
			legend entries = {$k = 1$, $k = 3$, $k = 5$, $k = 7$},
			no markers,
			every axis plot/.append style = {thick}
			]
			\addplot table [x=epsilon,y=k1] {\loadedtable};
			\addplot table [x=epsilon,y=k3] {\loadedtable};
			\addplot table [x=epsilon,y=k5] {\loadedtable};
			\addplot table [x=epsilon,y=k7] {\loadedtable};
		\end{axis}
	\end{tikzpicture}
	\captionsetup{justification=centering}
	\caption[Certified fairness on the whole German test set]{Certified fairness on the whole German test set.}
	\label{fig:certified-fairness-german}
\end{figure}